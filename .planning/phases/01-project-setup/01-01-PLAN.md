---
phase: 01-project-setup
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - package.json
  - tsconfig.json
  - rollup.config.mjs
  - hacs.json
  - src/main.ts
  - .gitignore

autonomous: true

must_haves:
  truths:
    - "npm run build completes without errors"
    - "dist/minime-card.js exists after build"
    - "TypeScript compiles with strict mode and no errors"
    - "hacs.json has correct metadata pointing to dist/minime-card.js"
  artifacts:
    - path: "package.json"
      provides: "Project manifest with dependencies and build script"
      contains: "rollup"
    - path: "tsconfig.json"
      provides: "TypeScript config with strict mode and decorators"
      contains: "experimentalDecorators"
    - path: "rollup.config.mjs"
      provides: "Rollup bundler config outputting ES module"
      contains: "dist/minime-card.js"
    - path: "hacs.json"
      provides: "HACS metadata for card discovery"
      contains: "minime-card.js"
    - path: "src/main.ts"
      provides: "Entry point stub for Rollup"
      min_lines: 5
    - path: "dist/minime-card.js"
      provides: "Bundled card output"
  key_links:
    - from: "rollup.config.mjs"
      to: "src/main.ts"
      via: "input entry point"
      pattern: "input.*src/main"
    - from: "rollup.config.mjs"
      to: "dist/minime-card.js"
      via: "output file path"
      pattern: "dist/minime-card\\.js"
    - from: "hacs.json"
      to: "dist/minime-card.js"
      via: "filename field matching build output"
      pattern: "minime-card\\.js"
---

<objective>
Initialize the MiniMe project with package dependencies, TypeScript configuration, Rollup build pipeline, and HACS-compatible metadata so that `npm run build` produces a valid `dist/minime-card.js` bundle.

Purpose: Establish the build foundation that all subsequent phases depend on. Getting HACS paths and Rollup output correct from day one prevents Pitfall #3 (resource path mismatch) which is nearly impossible to debug later.

Output: A buildable project that produces `dist/minime-card.js` from a minimal TypeScript entry point.
</objective>

<execution_context>
@/Users/matt/.claude/get-shit-done/workflows/execute-plan.md
@/Users/matt/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/research/STACK.md
@.planning/research/ARCHITECTURE.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Initialize project with dependencies and TypeScript config</name>
  <files>
    package.json
    tsconfig.json
    hacs.json
    .gitignore
  </files>
  <action>
    1. Run `npm init -y` in the project root to create package.json. Then update it:
       - Set name to "minime-card", version "0.1.0", description "Animated pixel art Home Assistant avatar card"
       - Set type to "module" (ESM)
       - Add a "build" script: `"build": "rollup -c rollup.config.mjs"`
       - Remove the default "test" and "main" scripts for now

    2. Install production dependencies:
       `npm install lit custom-card-helpers`

    3. Install dev dependencies:
       `npm install -D typescript tslib rollup @rollup/plugin-typescript @rollup/plugin-node-resolve @rollup/plugin-commonjs @rollup/plugin-terser`

    4. Create tsconfig.json with these settings:
       - target: "ES2021"
       - module: "ESNext"
       - moduleResolution: "bundler"
       - strict: true
       - experimentalDecorators: true
       - useDefineForClassFields: false (required for Lit decorators with experimentalDecorators)
       - declaration: false
       - sourceMap: true
       - outDir: "./dist"
       - rootDir: "./src"
       - include: ["src/**/*.ts"]
       - lib: ["ES2021", "DOM", "DOM.Iterable"]

    5. Create hacs.json in project root:
       ```json
       {
         "name": "MiniMe Card",
         "content_in_root": false,
         "filename": "minime-card.js",
         "render_readme": true,
         "homeassistant": "2025.1.0"
       }
       ```
       The filename "minime-card.js" MUST match the Rollup output filename exactly. content_in_root is false because our bundle lives in dist/.

    6. Create or update .gitignore to include:
       - node_modules/
       - dist/
       - *.js.map (source maps)
       - .DS_Store
  </action>
  <verify>
    - `cat package.json` shows correct dependencies and build script
    - `cat tsconfig.json` shows strict: true and experimentalDecorators: true
    - `cat hacs.json` shows filename: "minime-card.js"
    - `ls node_modules/lit` confirms lit is installed
    - `npx tsc --version` confirms TypeScript is available
  </verify>
  <done>package.json has all dependencies installed, tsconfig.json enables strict mode + decorators, hacs.json points to correct output filename, .gitignore excludes build artifacts</done>
</task>

<task type="auto">
  <name>Task 2: Create Rollup config and entry point, verify build produces dist/minime-card.js</name>
  <files>
    rollup.config.mjs
    src/main.ts
  </files>
  <action>
    1. Create src/ directory and src/main.ts as a minimal entry point:
       ```typescript
       // MiniMe Card - Entry Point
       // Card registration will go here in Phase 2

       const CARD_VERSION = '0.1.0';

       console.info(
         `%c MINIME-CARD %c v${CARD_VERSION} `,
         'color: white; background: #555; font-weight: bold;',
         'color: white; background: #007acc;'
       );
       ```
       This is intentionally minimal -- just enough TypeScript to verify the build pipeline works. The actual card class and customElements.define() come in Phase 2.

    2. Create rollup.config.mjs:
       ```javascript
       import typescript from '@rollup/plugin-typescript';
       import resolve from '@rollup/plugin-node-resolve';
       import commonjs from '@rollup/plugin-commonjs';
       import terser from '@rollup/plugin-terser';

       const dev = process.env.ROLLUP_WATCH === 'true';

       export default {
         input: 'src/main.ts',
         output: {
           file: 'dist/minime-card.js',
           format: 'es',
           sourcemap: dev,
         },
         plugins: [
           typescript(),
           resolve(),
           commonjs(),
           !dev && terser(),
         ],
       };
       ```
       Key decisions:
       - format: 'es' (ESM, required by modern HA)
       - sourcemap only in dev mode (smaller production bundles)
       - terser only in production (faster dev builds)
       - input points to src/main.ts, output to dist/minime-card.js (matching hacs.json)

    3. Run `npm run build` and verify:
       - Command exits with code 0
       - dist/minime-card.js exists
       - File contains the version console.info (not empty)

    4. Verify HACS path alignment:
       - hacs.json filename field matches the actual output file name
       - content_in_root is false and file is in dist/
  </action>
  <verify>
    - `npm run build` exits with code 0 (no errors)
    - `ls -la dist/minime-card.js` shows the file exists
    - `head -5 dist/minime-card.js` shows non-empty JavaScript content
    - The hacs.json filename ("minime-card.js") matches the built file name in dist/
  </verify>
  <done>Rollup successfully builds src/main.ts into dist/minime-card.js as an ES module. Build completes without TypeScript or bundler errors. HACS metadata filename matches build output.</done>
</task>

</tasks>

<verification>
Run these checks to verify Plan 01 is complete:

1. `npm run build` -- exits 0, no errors
2. `ls dist/minime-card.js` -- file exists
3. `cat tsconfig.json | grep strict` -- shows "strict": true
4. `cat tsconfig.json | grep experimentalDecorators` -- shows true
5. `cat hacs.json | grep filename` -- shows "minime-card.js"
6. `cat rollup.config.mjs | grep "dist/minime-card.js"` -- output path matches hacs.json
</verification>

<success_criteria>
- SETUP-01: Rollup outputs dist/minime-card.js -- VERIFIED by successful build
- SETUP-02: TypeScript strict mode + decorators -- VERIFIED by tsconfig.json settings and error-free compilation
- SETUP-03: HACS-compatible structure -- VERIFIED by hacs.json with correct filename and content_in_root: false
</success_criteria>

<output>
After completion, create `.planning/phases/01-project-setup/01-01-SUMMARY.md`
</output>
